<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>For NgotngaoğŸ¬</title>
<style>
  :root{
    --bg1:#ffd6e7;
    --bg2:#ffe6f0;
    --accent:#ff6fa3;
  }
  html,body{height:100%;margin:0;padding:0}
  body {
    margin: 0;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    font-family: 'Comic Sans MS', 'Brush Script MT', cursive;
    overflow: hidden;
    background: linear-gradient(180deg, var(--bg1) 0%, var(--bg2) 100%);
    animation: bgShift 18s ease-in-out infinite;
    position: relative;
  }

  @keyframes bgShift {
    0% { background: linear-gradient(180deg, #ffd6e7 0%, #ffe6f0 100%); }
    33% { background: linear-gradient(180deg, #fff1f6 0%, #ffeedd 100%); }
    66% { background: linear-gradient(180deg, #ffe9f2 0%, #fff0f8 100%); }
    100% { background: linear-gradient(180deg, #ffd6e7 0%, #ffe6f0 100%); }
  }

  /* ring text */
  .ring {
    position: absolute;
    top: 8%;
    left: 50%;
    transform: translateX(-50%);
    font-size: 16px;
    color: var(--accent);
    font-weight: bold;
    animation: rotate 12s linear infinite;
    text-shadow: 0 0 10px rgba(255,105,150,0.25);
    pointer-events: none;
    letter-spacing: 2px;
  }
  @keyframes rotate{
    from{transform: translateX(-50%) rotate(0deg)}
    to{transform: translateX(-50%) rotate(360deg)}
  }

  /* envelope */
  .envelope {
    position: relative;
    width: 260px;
    height: 170px;
    background: linear-gradient(180deg,#ffd7e3,#ffc9da);
    border-radius: 12px;
    box-shadow: 0 12px 30px rgba(0,0,0,0.18);
    cursor: pointer;
    transform-style: preserve-3d;
    perspective: 1000px;
    transition: transform .35s ease;
    z-index: 4;
  }
  .envelope:hover{ transform: translateY(-6px) scale(1.03); }

  .flap {
    position: absolute;
    top: 0;
    left: 0;
    width:100%;
    height:55%;
    background: linear-gradient(180deg,#ffb6c1,#ffa8b8);
    clip-path: polygon(0 0, 50% 100%, 100% 0);
    transform-origin: top;
    transition: transform .9s cubic-bezier(.2,.9,.3,1);
    backface-visibility: hidden;
  }

  .letter {
    position: absolute;
    top: 30%;
    left: 50%;
    transform: translateX(-50%) translateY(60px);
    width: 200px;
    background: white;
    padding: 22px;
    border-radius: 10px;
    box-shadow: 0 6px 14px rgba(0,0,0,0.08);
    text-align: left;
    opacity: 0;
    transition: all .9s ease;
    z-index: 3;
    font-size: 14px;
    color: #333;
    line-height: 1.45;
  }

  .open .flap { transform: rotateX(-180deg) translateY(-2px); }
  .open .letter { opacity: 1; transform: translateX(-50%) translateY(-78px); }

  .letter h3 { margin:0 0 8px 0; font-size:16px; text-align:center; }
  .letter .handwriting {
    font-family: 'Brush Script MT', 'Lucida Handwriting', cursive;
    font-size:15px;
    color:#b43b6d;
    min-height:56px;
    white-space:pre-wrap;
    word-wrap:break-word;
  }

  /* hearts container uses body as parent; hearts inserted dynamically */
  .heart {
    position: absolute;
    width: 12px;
    height: 12px;
    transform: rotate(45deg);
    pointer-events: none;
    will-change: transform, opacity;
    filter: drop-shadow(0 0 6px rgba(255,130,170,0.45));
  }
  .heart::before, .heart::after {
    content:"";
    position: absolute;
    width: 100%;
    height: 100%;
    background: currentColor;
    border-radius: 50%;
  }
  .heart::before { top: -50%; left: 0; }
  .heart::after { left: 50%; top: 0; }

  /* sparkle */
  .sparkle {
    position: absolute;
    width:6px;height:6px;border-radius:50%;
    background: radial-gradient(circle,#fff 0%, rgba(255,255,255,0) 70%);
    pointer-events:none;
    filter: blur(.6px);
  }

  /* small responsive tweak */
  @media (max-width:420px){
    .envelope{ width:220px; height:150px; }
    .letter{ width:180px; padding:16px; font-size:13px; }
  }
</style>
</head>
<body>

  <div class="ring">ğŸ’— Happy Anniversary ğŸ’— Happy Anniversary ğŸ’—</div>

  <div class="envelope" id="envelope">
    <div class="flap"></div>
    <div class="letter" id="letter">
      <h3>ğŸ’Œ Gá»­i: NgotngaoğŸ¬</h3>
      <div class="handwriting" id="message">
        <!-- lá»i chÃºc sáº½ Ä‘Æ°á»£c viáº¿t dáº§n bá»Ÿi JS -->
       Hiii em iu ! 
Nhanh tháº­t nhá»Ÿ tháº¿ lÃ  mÃ¬nh Ä‘Ã£ iu nhau Ä‘Æ°á»£c 2 nÄƒm rÃ¹i Ä‘Ã³. Anh khÃ´ng dÃ¡m dÃ¹ng tá»« á»Ÿ cáº¡nh vÃ¬ lÃ  2 nÄƒm iu nhau mÃ¬nh tráº£i qua quÃ£ng thá»i gian mÃ  mÃ¬nh xa nhau nhiá»u vÃ´ cÃ¹ng luÃ´n Ã­
Báº£n thÃ¢n anh nghÄ© mÃ¬nh cÅ©ng lÃ  má»™t nhÆ°á»i cá»©ng ráº¯n , cÃ³ kinh nghiá»‡m kiá»ƒm soÃ¡t yÃªu Ä‘Æ°Æ¡ng nma cá»© má»—i khi gáº·p vÃ  tháº¥y em, anh Ä‘á»u bá»‹ chÃ¹n áº¥y á»© muá»‘n nÃ©p vÃ o em Ã´m em thuiii.
Má»™t nÄƒm Ä‘áº§u tiÃªn quáº£ lÃ  tuyá»‡t Ä‘áº¹p, nma trá»i quang thÃ¬ dáº¥u hiá»‡u cá»§a má»™t cÆ¡n bÃ£o Ä‘ang tá»›i, nÄƒm thá»© 2 mÃ¬nh bÃªn nhau thá»±c sá»± ráº¥t khÃ³ khÄƒn cho cáº£ anh vÃ  em.Tá»« nhá»¯ng viá»‡c láº·t váº·t,
nhiá»u chuyá»‡n khÃ´ng Ä‘Ã¡ng nhÆ°ng vÃ¬ chÃºng mÃ¬nh cÃ³ cÃ¡i tÃ´i quÃ¡ cao nÃªn nhÆ° záº­y Ã­, tháº¿ nÃªn anh sáº½ tÃ¬m cÃ¡ch hÃ²a há»£p láº¡i. CÃ²n anh biáº¿t táº¡i sao hay cÃ£i nhau rÃ¹i, do tÃ¢m lÃ½ mÃ¬nh Ã­, trÆ°á»›c 
Ä‘Ã³ em hay Ä‘á» xuáº¥t chia tay thÃ¬ anh nghÄ© 1 pháº§n nÃ o Ä‘Ã³ trong em nghÄ© Ä‘áº¿n viá»‡c khÃ´ng cÃ³ anh cÅ©ng khÃ´ng sao, khÃ´ng pháº£i nhÆ° ngÃ y xÆ°a 2 ngÆ°á»i nhá»‹n nhau (cÃ¡i náº§y a tráº£i qua rÃ¹i anh bÃ­t).
NhÆ°ng mÃ  khÃ´ng sao, anh luÃ´n quan niá»‡m anh sáº½ cá»‘ gáº¯ng Ä‘áº¿n cÃ¹ng dÃ¹ anh biáº¿t quÃ¡ trÃ¬nh Ä‘Ã³ ráº¥t khÃ³ khÄƒn nÃªn mÃ¬nh cá»© coi Ä‘Ã¢y lÃ  tráº£i nghiá»‡m phÃ²ng viá»‡c em Ä‘i ANH cháº³ng háº¡n :)).
NhÆ°ng rÃ¹i lÃºc anh má»‡t má»i nháº¥t váº«n chá»‰ cÃ³ em tÃ¢m sá»± vÃ  anh tÃ¢m sá»± vá»›i em, cÅ©ng cÃ³ nhá»¯ng chuyá»‡n k thá»ƒ ká»ƒ cho em Ä‘Æ°á»£c vÃ¬ nhiá»u lÃ½ do xáº£y ra nÃªn em thÃ´ng cáº£m anh nha !!!
RÃ¹i Ä‘áº¿n lÃºc em bay vÃ o Ä‘Ã¢y chÆ¡i vá»›i anh, láº§n Ä‘áº§u dáº«n ngyeu Ä‘i chÆ¡i xa dÃ¹ mÃ¬nh chÆ°a Ä‘i bao giá», mÃ¬nh cÅ©ng cÃ³ nhá»¯ng ká»‰ niá»‡m siu vuiiii trong chuyáº¿n Ä‘i Ä‘Ã³, tÃ¬nh cáº£m cá»§a 2 Ä‘á»©a hÃ n gáº¯n láº¡i vÃ 
giáº£i tá»a cáº£m xÃºc nhá»› nhau hÆ¡n. Anh thá» vá»›i em, chá»‰ cáº§n nhÃ¬n tháº¥y em dÃ¹ make hay má»™c, chá»‰ cáº§n tháº¥y em thui lÃ  anh muá»‘n háº¡y vÃ o rÃºc vÃ o lÃ²ng em nhÆ° thá»i cÃ²n á»Ÿ nhÃ  Ã½...
Záº­y Ä‘Ã³, giÃ´ng bÃ£o nÃ o cÅ©ng sáº½ qua Ä‘i, má»i quyáº¿t Ä‘á»‹nh Ä‘Ãºng sai Ä‘á»u do mÃ¬nh, chÃºc tÃ¬nh iu cá»§a anh luÃ´n tÃ­ch cá»±c, cÃ³ nhiá»u Ä‘á»™ng lá»±c,nÃ³i chuyá»‡n khÃ©o lÃ©o hÆ¡n chÃºt lÃ  em Ä‘Ã£ Ä‘á»©ng á»Ÿ má»™t táº§m cao
khÃ¡c so vá»›i con gÃ¡i máº·t báº±ng chung tuá»•i em ruiiii. VÃ  ngÃ y cÃ ng yÃªu anh nhiá»u hÆ¡n, má»i quyáº¿t Ä‘á»‹nh a h mong chÃºng ta Ä‘á»u bÃ n báº¡c Ä‘Æ°á»£c vá»›i nhau Ä‘á»ƒ káº¿t quáº£ khÃ´ng ai pháº£i há»‘i tiáº¿c nhÃ©
                 ANH YÃŠU EM <3
        Anh mong anh sáº½ sá»›m trá»Ÿ vá» cáº¡nh em cÃ¹ng em bÆ°á»›c Ä‘i tiáº¿p dÃ¹ cho hoÃ n cáº£nh nhÆ° nÃ o nhÃ©eeeğŸ’•
Note: cÃ³ vÃ i Ä‘oáº¡n a Ä‘á»‹nh viáº¿t nháº­t kÃ­ nma do Ä‘Ãªm anh lÆ°á»i quÃ¡ nÃªn táº¡m gÃ¡c láº¡i:

      </div>
    </div>
  </div>

<script>
/* ---------- preserve original structure: envelope + letter ---------- */
const envelope = document.getElementById('envelope');
const letter = document.getElementById('letter');
const messageEl = document.getElementById('message');
let isOpen = false;

/* write-effect: hide text initially, reveal char-by-char when opened */
const originalText = messageEl.textContent.trim();
messageEl.textContent = ''; // clear to animate later

function revealText() {
  messageEl.textContent = '';
  let i = 0;
  const speed = 28; // ms per char (handwriting feel)
  const interval = setInterval(()=> {
    messageEl.textContent += originalText.charAt(i);
    i++;
    if(i >= originalText.length) clearInterval(interval);
  }, speed);
}

/* envelope click toggles open + play piano music */
envelope.addEventListener('click', async () => {
  envelope.classList.toggle('open');
  isOpen = envelope.classList.contains('open');
  if(isOpen){
    revealText();
    startPianoLoop(); // start background piano
  } else {
    // closing: optionally stop music
    stopPianoLoop();
    // reset text so it writes again next open
    setTimeout(()=> { messageEl.textContent = ''; }, 300);
  }
});

/* ---------- Hearts + sparkles system ---------- */
const maxHearts = 120; // upper bound to control perf
let heartCount = 0;

// utility to random between range
function rand(min, max) { return min + Math.random()*(max-min); }

// create one heart with randomized properties
function spawnHeart() {
  if(heartCount > maxHearts) return;
  heartCount++;
  const el = document.createElement('div');
  el.className = 'heart';
  // size variations
  const size = Math.floor(rand(8, 28));
  el.style.width = size + 'px';
  el.style.height = size + 'px';
  // color variations in pink palette
  const hue = Math.floor(rand(320,350));
  const light = Math.floor(rand(60,85));
  el.style.color = `hsl(${hue} 80% ${light}%)`;
  // start position bottom random
  const startX = rand(5, 95); // % of viewport width
  el.style.left = startX + 'vw';
  el.style.bottom = '-6vh';
  el.style.opacity = 0;

  // animation parameters
  const rise = rand(6, 16); // seconds to rise
  const driftX = rand(-10,10); // vw drift from start
  const rotate = rand(-720,720); // degrees over lifetime
  const delay = 0;

  document.body.appendChild(el);

  // use requestAnimationFrame loop for smooth motion and control
  const start = performance.now() + delay*1000;
  const lifetime = rise * 1000;
  function animate(now){
    const t = (now - start) / lifetime; // 0..1
    if(t < 0){
      requestAnimationFrame(animate); return;
    }
    if(t >= 1){
      el.remove(); heartCount--; return;
    }
    // vertical progress
    const ease = t<0.6 ? (t/0.6) : 1 - Math.pow((t-0.6)/0.4,2);
    const y = ease * (110 + rand(0,20)); // vh
    const x = startX + driftX * ease;
    const rot = rotate * ease;
    const opa = Math.max(0, 1 - t*1.1);
    el.style.transform = `translate3d(${(x - startX)}vw, -${y}vh, 0) rotate(${45 + rot}deg)`;
    el.style.opacity = opa;
    requestAnimationFrame(animate);
  }
  requestAnimationFrame(animate);

  // occasional sparkle near heart
  if(Math.random() < 0.35){
    spawnSparkleNear(el, size);
  }
}

// create sparkle near heart element
function spawnSparkleNear(anchorEl, size){
  const s = document.createElement('div');
  s.className = 'sparkle';
  const rect = anchorEl.getBoundingClientRect();
  // random small offset from heart
  const left = rect.left + rand(-8,8);
  const top = rect.top + rand(-8,8);
  s.style.left = left + 'px';
  s.style.top = top + 'px';
  document.body.appendChild(s);
  // animate opacity + scale via simple JS loop
  const dur = rand(1000,2400);
  const start = performance.now();
  function anim(now){
    const t = (now - start)/dur;
    if(t >= 1){ s.remove(); return; }
    const scale = 0.6 + 0.8 * Math.sin(Math.PI * t);
    s.style.transform = `scale(${scale})`;
    s.style.opacity = (1 - t*1.1).toString();
    requestAnimationFrame(anim);
  }
  requestAnimationFrame(anim);
}

// spawn hearts continuously with various rates
setInterval(()=> {
  // burst sometimes
  const burst = Math.random() < 0.09;
  if(burst){
    const count = Math.floor(rand(5,18));
    for(let i=0;i<count;i++){
      setTimeout(spawnHeart, i * rand(50,160));
    }
  } else {
    spawnHeart();
  }
}, 160);

/* ---------- Soft ambient sparkles throughout background ---------- */
setInterval(()=> {
  const s = document.createElement('div');
  s.className = 'sparkle';
  s.style.left = rand(2,98) + 'vw';
  s.style.top = rand(2,98) + 'vh';
  s.style.opacity = 0;
  document.body.appendChild(s);
  const dur = rand(2000,5200);
  const start = performance.now();
  function anim(now){
    const t = (now - start) / dur;
    if(t >= 1){ s.remove(); return; }
    // pulse
    const opacity = 0.15 + 0.65 * Math.sin(Math.PI * t);
    const scale = 0.6 + 0.9 * Math.sin(Math.PI * t);
    s.style.opacity = opacity;
    s.style.transform = `scale(${scale})`;
    requestAnimationFrame(anim);
  }
  requestAnimationFrame(anim);
}, 420);

/* ---------- Simple WebAudio "piano-like" loop ---------- */
/* This is a gentle synthesized piano-ish progression. It plays after envelope opens. */
let audioCtx = null;
let pianoPlaying = false;
let scheduled = [];
function ensureAudio() {
  if(!audioCtx){
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  }
}

/* play a single "note" with short attack, longer release; uses multiple oscillators + filter to approximate mellow tone */
function playNoteAt(time, freq, duration, velocity=0.9) {
  const ctx = audioCtx;
  // carriers
  const o1 = ctx.createOscillator(); o1.type = 'sine'; o1.frequency.value = freq;
  const o2 = ctx.createOscillator(); o2.type = 'sine'; o2.frequency.value = freq * 2.002; // tiny detune
  const o3 = ctx.createOscillator(); o3.type = 'triangle'; o3.frequency.value = freq * 0.999;

  // gain envelopes
  const g = ctx.createGain(); g.gain.value = 0;
  const g2 = ctx.createGain(); g2.gain.value = 0;
  const out = ctx.createGain(); out.gain.value = velocity * 0.65;

  // filter to mellow
  const filter = ctx.createBiquadFilter(); filter.type = 'lowpass'; filter.frequency.value = 3500;

  o1.connect(g);
  o2.connect(g2);
  o3.connect(g2);
  g.connect(filter);
  g2.connect(filter);
  filter.connect(out);
  out.connect(ctx.destination);

  const attack = 0.012;
  const release = Math.max(0.6, duration * 0.9);
  g.gain.setValueAtTime(0, time);
  g.gain.linearRampToValueAtTime(1.0, time + attack);
  g.gain.exponentialRampToValueAtTime(0.0001, time + duration + release);

  g2.gain.setValueAtTime(0, time);
  g2.gain.linearRampToValueAtTime(0.6, time + attack*1.2);
  g2.gain.exponentialRampToValueAtTime(0.0001, time + duration + release + 0.08);

  o1.start(time); o2.start(time); o3.start(time);
  o1.stop(time + duration + release + 0.12);
  o2.stop(time + duration + release + 0.12);
  o3.stop(time + duration + release + 0.12);
}

/* a chord helper */
function playChordAt(time, freqs, dur) {
  freqs.forEach(f => playNoteAt(time, f, dur, 0.7));
}

/* schedule a soft looping progression */
let pianoIntervalId = null;
function startPianoLoop(){
  if(pianoPlaying) return;
  ensureAudio();
  // resume context if suspended by browser
  if(audioCtx.state === 'suspended') audioCtx.resume();
  pianoPlaying = true;

  // simple progression in C major-ish (frequencies)
  const C4 = 261.63, E4 = 329.63, G4 = 392.00, A4 = 440.00;
  const A3 = 220.00, F3 = 174.61, D4 = 293.66;
  // loop function: schedule a few measures
  let t0 = audioCtx.currentTime + 0.05;
  function scheduleOnce(){
    let t = t0;
    // measure 1: C major arpeggio
    playNoteAt(t, C4, 0.9); playNoteAt(t+0.18, E4, 0.9, 0.65); playNoteAt(t+0.36, G4, 1.0, 0.6);
    // gentle chord
    playChordAt(t+1.1, [C4, E4, G4], 1.4);
    // measure 2: F -> Dm feel
    playNoteAt(t+2.6, F3*2, 0.9); playNoteAt(t+2.82, A3*2, 1.1);
    playChordAt(t+3.6, [D4, F3*2, A3*2], 1.4);
    // little flourish
    playNoteAt(t+5.3, G4, 0.6); playNoteAt(t+5.6, E4, 0.5);
    t0 = t + 6.2; // next cycle
  }
  scheduleOnce();
  pianoIntervalId = setInterval(scheduleOnce, 6200); // schedule repeatedly
}

function stopPianoLoop(){
  if(!pianoPlaying) return;
  pianoPlaying = false;
  if(pianoIntervalId) { clearInterval(pianoIntervalId); pianoIntervalId = null; }
  // suspend audio context for quietness
  if(audioCtx && audioCtx.state === 'running') {
    try { audioCtx.suspend(); } catch(e) { /* ignore */ }
  }
}

/* optional: auto-stop after long time to save CPU (10 minutes) */
setInterval(()=> {
  if(!pianoPlaying) return;
  // if playing for >10min, stop
  // (for simplicity no tracking; leaving it to user to close)
}, 600000);

</script>
</body>
</html>
